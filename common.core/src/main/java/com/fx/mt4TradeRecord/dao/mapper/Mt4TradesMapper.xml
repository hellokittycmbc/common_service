<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd" >
<mapper namespace="com.fx.mt4TradeRecord.dao.IMt4TradesDao" >
	<resultMap id="BaseResultMap" type="com.fx.mt4TradeRecord.model.Mt4Trades" >
		<id column="TICKET" property="ticket" jdbcType="INTEGER" />
		<result column="LOGIN" property="login" jdbcType="INTEGER" />
		<result column="SYMBOL" property="symbol" jdbcType="CHAR" />
		<result column="DIGITS" property="digits" jdbcType="INTEGER" />
		<result column="CMD" property="cmd" jdbcType="INTEGER" />
		<result column="VOLUME" property="volume" jdbcType="INTEGER" />
		<result column="OPEN_TIME" property="openTime" jdbcType="TIMESTAMP" />
		<result column="OPEN_PRICE" property="openPrice" jdbcType="DOUBLE" />
		<result column="SL" property="sl" jdbcType="DOUBLE" />
		<result column="TP" property="tp" jdbcType="DOUBLE" />
		<result column="CLOSE_TIME" property="closeTime" jdbcType="TIMESTAMP" />
		<result column="EXPIRATION" property="expiration" jdbcType="TIMESTAMP" />
		<result column="REASON" property="reason" jdbcType="INTEGER" />
		<result column="CONV_RATE1" property="convRate1" jdbcType="DOUBLE" />
		<result column="CONV_RATE2" property="convRate2" jdbcType="DOUBLE" />
		<result column="COMMISSION" property="commission" jdbcType="DOUBLE" />
		<result column="COMMISSION_AGENT" property="commissionAgent" jdbcType="DOUBLE" />
		<result column="SWAPS" property="swaps" jdbcType="DOUBLE" />
		<result column="CLOSE_PRICE" property="closePrice" jdbcType="DOUBLE" />
		<result column="PROFIT" property="profit" jdbcType="DOUBLE" />
		<result column="TAXES" property="taxes" jdbcType="DOUBLE" />
		<result column="COMMENT" property="comment" jdbcType="CHAR" />
		<result column="INTERNAL_ID" property="internalId" jdbcType="INTEGER" />
		<result column="MARGIN_RATE" property="marginRate" jdbcType="DOUBLE" />
		<result column="TIMESTAMP" property="timestamp" jdbcType="INTEGER" />
		<result column="GW_VOLUME" property="gwVolume" jdbcType="INTEGER" />
		<result column="GW_OPEN_PRICE" property="gwOpenPrice" jdbcType="INTEGER" />
		<result column="GW_CLOSE_PRICE" property="gwClosePrice" jdbcType="INTEGER" />
		<result column="MODIFY_TIME" property="modifyTime" jdbcType="TIMESTAMP" />
	</resultMap>
	<resultMap id="ComprehensiveReportOnedayMap" type="com.fx.mt4TradeRecord.model.ComprehensiveReportOneday">
		<id column="id" property="id" jdbcType="INTEGER" />
		<result column="ib_name" property="ibName" jdbcType="VARCHAR" />
		<result column="account" property="account" jdbcType="INTEGER" />
		<result column="name" property="name" jdbcType="VARCHAR" />
		<result column="early_amount" property="earlyAmount" jdbcType="NUMERIC" />
		<result column="amount_in" property="amountIn" jdbcType="NUMERIC" />
		<result column="amount_out" property="amountOut" jdbcType="NUMERIC" />
		<result column="commission" property="commission" jdbcType="NUMERIC" />
		<result column="taxes" property="taxes" jdbcType="NUMERIC" />
		<result column="profit" property="profit" jdbcType="NUMERIC" />
		<result column="last_amount" property="lastAmount" jdbcType="NUMERIC" />
		<result column="create_date" property="createDate" jdbcType="VARCHAR" />
		<result column="update_date" property="updateDate" jdbcType="VARCHAR" />
		<result column="calculate_date" property="calculateDate" jdbcType="VARCHAR" />
		<result column="status" property="status" jdbcType="INTEGER" />
	</resultMap>
	<resultMap id="ProfitMap" type="com.fx.mt4TradeRecord.model.Mt4Trades">
		<id column="LOGIN" property="login" jdbcType="INTEGER" />
		<result column="PROFIT" property="profit" jdbcType="DOUBLE" />
	</resultMap>

	<resultMap id="AgentUserMap" type="com.fx.mt4TradeRecord.model.Mt4Trades">
		<id column="LOGIN" property="login" jdbcType="INTEGER" />
		<result column="VOLUME" property="volume" jdbcType="INTEGER" />
	</resultMap>

	<resultMap id="RPQueryVolumeMap" type="com.fx.RPQueryVolume.model.RPQueryVolume" >
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="type" property="type" jdbcType="VARCHAR" />
		<result column="date" property="date" jdbcType="VARCHAR" />
		<result column="bbookfx" property="bbookfx" jdbcType="NUMERIC" />
		<result column="bbookindex" property="bbookindex" jdbcType="NUMERIC" />
		<result column="sbookfx" property="sbookfx" jdbcType="NUMERIC" />
		<result column="sbookindex" property="sbookindex" jdbcType="NUMERIC" />
		<result column="bbookfxprofit" property="bbookfxprofit" jdbcType="NUMERIC" />
		<result column="bbookindexprofit" property="bbookindexprofit" jdbcType="NUMERIC" />
		<result column="sbookfxprofit" property="sbookfxprofit" jdbcType="NUMERIC" />
		<result column="sbookindexprofit" property="sbookindexprofit" jdbcType="NUMERIC" />
	</resultMap>

	<resultMap id="BbookuserMap" type="com.fx.bbookuserReport.model.BbookuserReport" >
		<result column="id" property="id" jdbcType="INTEGER" />
		<result column="login" property="login" jdbcType="INTEGER" />
		<result column="old_equity" property="oldEquity" jdbcType="NUMERIC" />
		<result column="deposit" property="deposit" jdbcType="NUMERIC" />
		<result column="withdraw" property="withdraw" jdbcType="NUMERIC" />
		<result column="trades" property="trades" jdbcType="NUMERIC" />
		<result column="exchange" property="exchange" jdbcType="NUMERIC" />
		<result column="gold" property="gold" jdbcType="NUMERIC" />
		<result column="silver" property="silver" jdbcType="NUMERIC" />
		<result column="oil" property="oil" jdbcType="NUMERIC" />
		<result column="new_equity" property="newEquity" jdbcType="NUMERIC" />
		<result column="create_date" property="createDate" jdbcType="VARCHAR" />
		<result column="A50" property="a50" jdbcType="NUMERIC" />
	</resultMap>

	<sql id="Base_Column_List" >
    TICKET, LOGIN, SYMBOL, DIGITS, CMD, VOLUME, OPEN_TIME, OPEN_PRICE, SL, TP, CLOSE_TIME, 
    EXPIRATION, REASON, CONV_RATE1, CONV_RATE2, COMMISSION, COMMISSION_AGENT, SWAPS, 
    CLOSE_PRICE, PROFIT, TAXES, COMMENT, INTERNAL_ID, MARGIN_RATE, TIMESTAMP, GW_VOLUME, 
    GW_OPEN_PRICE, GW_CLOSE_PRICE, MODIFY_TIME
  </sql>
	<delete id="deleteByPrimaryKey" parameterType="java.lang.Integer" >
    delete from mt4_trades
    where TICKET = #{ticket,jdbcType=INTEGER}
  </delete>
	<insert id="insert" parameterType="com.fx.mt4TradeRecord.model.Mt4Trades" >
    insert into mt4_trades (TICKET, LOGIN, SYMBOL, 
      DIGITS, CMD, VOLUME, 
      OPEN_TIME, OPEN_PRICE, SL, 
      TP, CLOSE_TIME, EXPIRATION, 
      REASON, CONV_RATE1, CONV_RATE2, 
      COMMISSION, COMMISSION_AGENT, SWAPS, 
      CLOSE_PRICE, PROFIT, TAXES, 
      COMMENT, INTERNAL_ID, MARGIN_RATE, 
      TIMESTAMP, GW_VOLUME, GW_OPEN_PRICE, 
      GW_CLOSE_PRICE, MODIFY_TIME)
    values (#{ticket,jdbcType=INTEGER}, #{login,jdbcType=INTEGER}, #{symbol,jdbcType=CHAR}, 
      #{digits,jdbcType=INTEGER}, #{cmd,jdbcType=INTEGER}, #{volume,jdbcType=INTEGER}, 
      #{openTime,jdbcType=TIMESTAMP}, #{openPrice,jdbcType=DOUBLE}, #{sl,jdbcType=DOUBLE}, 
      #{tp,jdbcType=DOUBLE}, #{closeTime,jdbcType=TIMESTAMP}, #{expiration,jdbcType=TIMESTAMP}, 
      #{reason,jdbcType=INTEGER}, #{convRate1,jdbcType=DOUBLE}, #{convRate2,jdbcType=DOUBLE}, 
      #{commission,jdbcType=DOUBLE}, #{commissionAgent,jdbcType=DOUBLE}, #{swaps,jdbcType=DOUBLE}, 
      #{closePrice,jdbcType=DOUBLE}, #{profit,jdbcType=DOUBLE}, #{taxes,jdbcType=DOUBLE}, 
      #{comment,jdbcType=CHAR}, #{internalId,jdbcType=INTEGER}, #{marginRate,jdbcType=DOUBLE}, 
      #{timestamp,jdbcType=INTEGER}, #{gwVolume,jdbcType=INTEGER}, #{gwOpenPrice,jdbcType=INTEGER}, 
      #{gwClosePrice,jdbcType=INTEGER}, #{modifyTime,jdbcType=TIMESTAMP})
  </insert>
	<update id="updateByPrimaryKey" parameterType="com.fx.mt4TradeRecord.model.Mt4Trades" >
    update mt4_trades
    set LOGIN = #{login,jdbcType=INTEGER},
      SYMBOL = #{symbol,jdbcType=CHAR},
      DIGITS = #{digits,jdbcType=INTEGER},
      CMD = #{cmd,jdbcType=INTEGER},
      VOLUME = #{volume,jdbcType=INTEGER},
      OPEN_TIME = #{openTime,jdbcType=TIMESTAMP},
      OPEN_PRICE = #{openPrice,jdbcType=DOUBLE},
      SL = #{sl,jdbcType=DOUBLE},
      TP = #{tp,jdbcType=DOUBLE},
      CLOSE_TIME = #{closeTime,jdbcType=TIMESTAMP},
      EXPIRATION = #{expiration,jdbcType=TIMESTAMP},
      REASON = #{reason,jdbcType=INTEGER},
      CONV_RATE1 = #{convRate1,jdbcType=DOUBLE},
      CONV_RATE2 = #{convRate2,jdbcType=DOUBLE},
      COMMISSION = #{commission,jdbcType=DOUBLE},
      COMMISSION_AGENT = #{commissionAgent,jdbcType=DOUBLE},
      SWAPS = #{swaps,jdbcType=DOUBLE},
      CLOSE_PRICE = #{closePrice,jdbcType=DOUBLE},
      PROFIT = #{profit,jdbcType=DOUBLE},
      TAXES = #{taxes,jdbcType=DOUBLE},
      COMMENT = #{comment,jdbcType=CHAR},
      INTERNAL_ID = #{internalId,jdbcType=INTEGER},
      MARGIN_RATE = #{marginRate,jdbcType=DOUBLE},
      TIMESTAMP = #{timestamp,jdbcType=INTEGER},
      GW_VOLUME = #{gwVolume,jdbcType=INTEGER},
      GW_OPEN_PRICE = #{gwOpenPrice,jdbcType=INTEGER},
      GW_CLOSE_PRICE = #{gwClosePrice,jdbcType=INTEGER},
      MODIFY_TIME = #{modifyTime,jdbcType=TIMESTAMP}
    where TICKET = #{ticket,jdbcType=INTEGER}
  </update>
	<select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Integer" >
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where TICKET = #{ticket,jdbcType=INTEGER}
	</select>
	<select id="selectAll" resultMap="BaseResultMap" >
		select
		<include refid="Base_Column_List" />
		from mt4_trades
	</select>

	<select id="queryListByAccount" resultMap="BaseResultMap" parameterType="java.util.Map" >
		SELECT <include refid="Base_Column_List" /> FROM mt4_trades z  WHERE z.TICKET  NOT IN(SELECT
		TICKET
		FROM mt4_trades t
		INNER JOIN mt4_symbols s
		WHERE LEFT(t.symbol,LENGTH(t.symbol)-2) = s.symbol
		AND s.group != 'Forex' AND
		LOGIN=#{login,jdbcType=INTEGER} and CMD&lt;2  and CLOSE_TIME between #{date1,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP}) AND LOGIN=#{login,jdbcType=INTEGER}
		and CMD&lt;2  and CLOSE_TIME between #{date1,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP}

	</select>

	<select id="getMt4TradesByDate" resultMap="BaseResultMap" parameterType="java.util.Map" >
		SELECT <include refid="Base_Column_List" /> FROM mt4_trades where CMD &lt; 2  and CLOSE_TIME between #{date1,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP}
	</select>

	<select id="getMt4TradesByAccountAndDate" resultMap="BaseResultMap" parameterType="java.util.Map" >
		SELECT <include refid="Base_Column_List" /> FROM mt4_trades where CMD &lt; 2 and  LOGIN=#{mt4Account,jdbcType=INTEGER} and CLOSE_TIME between #{date1,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP}
	</select>

	<select id="findTradedLoginByDate" resultType="java.lang.Integer" parameterType="java.util.Map" >
		SELECT DISTINCT LOGIN FROM mt4_trades where CMD &lt; 2 and CLOSE_TIME between #{date1,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP}
	</select>

	<select id="getMt4TradesByCloseTimeGroup" resultMap="ProfitMap" parameterType="java.util.Map" >
    SELECT login,sum(profit) profit FROM mt4_trades z  WHERE 
    CMD &lt; 2  and CLOSE_TIME between #{date1,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP} group by login
  </select>

  
  <select id="getmt4TradesByAgent" resultMap="AgentUserMap" parameterType="java.util.Map" >
    SELECT login,sum(volume) as volume FROM mt4_trades z  WHERE 
    CMD &lt; 2
    <if test="login!=null">and LOGIN = #{login}</if>
	  <if test="userMT4Accounts != null">
		  and login IN
		  <foreach item="login" index="index" collection="userMT4Accounts" open="(" separator="," close=")">
			  #{login.mt4Account}
		  </foreach>
	  </if>
    <if test="loginList!=null">
    	and login in <foreach item="logins" index="index" collection="loginList" open="(" separator="," close=")"> #{logins}</foreach>  
    </if>  
    and (open_time between #{startDate,jdbcType=TIMESTAMP} and #{endDate,jdbcType=TIMESTAMP} or close_time between #{startDate,jdbcType=TIMESTAMP} and #{endDate,jdbcType=TIMESTAMP} ) group by login 
  </select>

	<select id="queryCountByCondition" resultType="java.lang.Integer" parameterType="java.util.Map" >
    select
    count(1)
    from mt4_trades
    where CMD in (0,1,6)
  </select>

	<select id="queryByCondition" resultMap="BaseResultMap" parameterType="java.util.Map" >
		select
		<include refid="Base_Column_List" />
		from mt4_trades  where CMD in (0,1,6)
		<if test="offset gt 0">
			and (
			(SELECT MIN(TICKET) FROM (SELECT TICKET FROM mt4_trades where CMD in (0,1,6)
			ORDER BY TICKET desc LIMIT ${offset}) AS T) > TICKET
			)
		</if>
		order by TICKET desc LIMIT ${limit}
	</select>

	<select id="queryCountByConditionByIb" resultType="java.lang.Integer" parameterType="java.util.Map" >
		select
		count(1)
		from mt4_trades
		where CLOSE_TIME between #{date1,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP} and CMD in (0,1,6) and LOGIN in
		<foreach item="item" index="index" collection="list" open="(" separator="," close=")">
			#{item}
		</foreach>
	</select>

	<select id="queryByConditionByIb" resultMap="BaseResultMap" parameterType="java.util.Map" >
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where CLOSE_TIME between #{date1,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP} and CMD in (0,1,6) and LOGIN in
		<foreach item="item" index="index" collection="list" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="offset gt 0">
			and (
			(SELECT MIN(TICKET) FROM (SELECT TICKET	FROM mt4_trades
			where CLOSE_TIME between #{date1,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP} and CMD in (0,1,6) and LOGIN in
			<foreach item="item" index="index" collection="list" open="(" separator="," close=")">
				#{item}
			</foreach>
			ORDER BY TICKET desc LIMIT ${offset}) AS T) > TICKET
			)
		</if>
		order by TICKET desc LIMIT ${limit}
	</select>

	<select id="queryCountByConditionByAccount" resultType="java.lang.Integer" parameterType="java.util.Map" >
    select
    count(1)
    from mt4_trades
    where CMD in (0,1,6) and LOGIN = #{mt4Account}  
  </select>

	<select id="queryByConditionByAccount" resultMap="BaseResultMap" parameterType="java.util.Map" >
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where CMD in (0,1,6) and LOGIN = #{mt4Account}
		<if test="offset gt 0">
			and (
			(SELECT MIN(TICKET) FROM (SELECT TICKET	FROM mt4_trades
			where CMD in (0,1,6) and LOGIN = #{mt4Account}
			ORDER BY TICKET desc LIMIT ${offset}) AS T) > TICKET
			)
		</if>
		order by TICKET desc LIMIT ${limit}
	</select>
	<select id="queryCountByConditionByAccountHistory" resultType="java.lang.Integer" parameterType="java.util.Map" >
    select
    count(1)
    from mt4_trades
    where CMD in (0,1,6) and LOGIN = #{mt4Account} and CLOSE_TIME between #{date1,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP} 
  </select>

	<select id="queryByConditionByAccountHistory" resultMap="BaseResultMap" parameterType="java.util.Map" >
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where CMD in (0,1,6) and LOGIN = #{mt4Account} and CLOSE_TIME between #{date1,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP}
		<if test="offset gt 0">
			and (
			(SELECT MIN(TICKET) FROM (SELECT TICKET	FROM mt4_trades
			where CMD in (0,1,6) and LOGIN = #{mt4Account} and CLOSE_TIME between #{date1,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP}
			ORDER BY TICKET desc LIMIT ${offset}) AS T) > TICKET
			)
		</if>
		order by TICKET desc LIMIT ${limit}
	</select>

	<select id="queryCountByConditionByIbHistory" resultType="java.lang.Integer" parameterType="java.util.Map" >
		select
		count(1)
		from mt4_trades
		where CMD in (0,1,6) and LOGIN in
		<foreach item="item" index="index" collection="list" open="(" separator="," close=")">
			#{item}
		</foreach>
	</select>

	<select id="queryByConditionByIbHistory" resultMap="BaseResultMap" parameterType="java.util.Map" >
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where CMD in (0,1,6) and LOGIN in
		<foreach item="item" index="index" collection="list" open="(" separator="," close=")">
			#{item}
		</foreach>
		<if test="offset gt 0">
			and (
			(SELECT MIN(TICKET) FROM (SELECT TICKET	FROM mt4_trades
			where CMD in (0,1,6) and LOGIN in
			<foreach item="item" index="index" collection="list" open="(" separator="," close=")">
				#{item}
			</foreach>
			ORDER BY TICKET desc LIMIT ${offset}) AS T) > TICKET
			)
		</if>
		order by TICKET desc LIMIT ${limit}
	</select>

	<select id="queryBytype1" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where close_time='1970-1-1' and cmd &lt; 2 and (SL>0 or TP>0)
		<if test="startTime!=null and startTime !='' and endTime!=null and endTime !='' ">
			and OPEN_TIME BETWEEN #{startTime,jdbcType=TIMESTAMP} AND #{endTime,jdbcType=TIMESTAMP}
		</if>
	</select>
	<!--挂单查询表-->
	<select id="queryBytype2" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where cmd BETWEEN 2 AND 5
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND OPEN_TIME BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginlist != null and loginlist">
			and login in
			<foreach item="logins" index="index" collection="loginlist"
					 open="(" separator="," close=")">
				#{logins}
			</foreach>
		</if>
		<if test="loginlist == null">
			and login in ('')
		</if>
		ORDER BY OPEN_TIME DESC
	</select>
	<!--持仓查询-->
	<select id="queryBytype3" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where cmd &lt; 2 and close_time='1970-1-1'
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND OPEN_TIME BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="login!='' and login!=null">
			AND login = #{login,jdbcType=VARCHAR}
		</if>
		<!--    <if test="startnum!='' and startnum!=null and startnum>0">
            limit (#{startnum,jdbcType=INTEGER}-1)*10+1,#{startnum,jdbcType=INTEGER}*10
            </if>-->
	</select>
	<!--交易量佣金-->
	<select id="queryBytype4" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		count(VOLUME) VOLUME,
		LOGIN
		from mt4_trades
		where close_time>'1970-1-1' and cmd &lt; 2
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND OPEN_TIME BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="login!='' and login!=null">
			AND login = #{login,jdbcType=VARCHAR}
		</if>
		<!--    <if test ="loginId !=null">
              AND
            </if>-->
		GROUP by LOGIN
		order BY  LOGIN ASC
	</select>
	<!--存取款报表-->
	<select id="queryBytype5" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where cmd=6 and close_time>'1970-1-1'
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND OPEN_TIME BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="login!='' and login!=null">
			AND login = #{login,jdbcType=VARCHAR}
		</if>
		order BY  LOGIN ASC
	</select>

  <select id="findByPageCondition" resultMap="BaseResultMap" parameterType="java.util.Map">
    SELECT
    <include refid="Base_Column_List"/>

    FROM mt4_trades
    WHERE 1 = 1
    <if test="closeTime != null">
      and close_time = #{closeTime,jdbcType=TIMESTAMP}
    </if>
    <if test="login != null">
      and login = #{login,jdbcType=INTEGER}
    </if>
    <if test="closeTimeBegin != null">
      and close_time &gt;= #{closeTimeBegin,jdbcType=TIMESTAMP}
    </if>
    <if test="closeTimeEnd != null">
      and close_time &lt;= #{closeTimeEnd,jdbcType=TIMESTAMP}
    </if>
    ORDER BY close_time desc
  </select>
   <select id="getmt4TradesByTrading" resultMap="BaseResultMap" parameterType="java.util.Map">
    SELECT
    <include refid="Base_Column_List"/>
    FROM mt4_trades
    WHERE  CMD&lt;2 and OPEN_TIME between #{startDate,jdbcType=TIMESTAMP} and #{endDate,jdbcType=TIMESTAMP}
    <!--<if test="login != null">
      and login = #{login,jdbcType=INTEGER}
    </if>-->
    <if test="loginList!=null">
		and login in
		<foreach collection="loginList" item="logins" separator="," open="(" close=")">#{logins,jdbcType=INTEGER}</foreach>
	</if>
    <if test="symbolsList != null">
    	and SYMBOL in <foreach collection="symbolsList" item="symbols" separator="," open="(" close=")">#{symbols,jdbcType=VARCHAR}</foreach>
    </if>
    ORDER BY close_time desc
  </select>
  
  <select id="findCommissionDetail" resultMap="BaseResultMap" parameterType="java.util.Map">
    SELECT
    count(volume) volume,
	symbol
	FROM mt4_trades
	where close_time > '1970-1-1' and cmd &lt; 2
	<if test="login!=null and login!=''">
      and LOGIN = #{login,jdbcType=INTEGER}
    </if>
    GROUP BY symbol
  </select>

	<select id="findMt4TradesByLoginList" resultMap="BaseResultMap" parameterType="java.util.Map" >
		select
		TICKET, LOGIN, SYMBOL, DIGITS, CMD, sum(VOLUME) as VOLUME, OPEN_TIME, OPEN_PRICE, SL, TP, CLOSE_TIME,
		EXPIRATION, REASON, CONV_RATE1, CONV_RATE2, COMMISSION, COMMISSION_AGENT, SWAPS,
		CLOSE_PRICE, PROFIT, TAXES, COMMENT, INTERNAL_ID, MARGIN_RATE, TIMESTAMP, GW_VOLUME,
		GW_OPEN_PRICE, GW_CLOSE_PRICE, MODIFY_TIME
		from mt4_trades
		where 1 = 1
		<if test="userMT4AccountList != null">
			and login in
			<foreach item="login" index="index" collection="userMT4AccountList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="queryFrom != null">
			and close_time &gt;= #{queryFrom,jdbcType=TIMESTAMP}
		</if>
		<if test="queryTo != null">
			and close_time &lt;= #{queryTo,jdbcType=TIMESTAMP}
		</if>
		and symbol != ''
		group by login order by login desc
	</select>
	<select id="queryCountByConditionGroupBySymbol" resultType="java.lang.Integer" parameterType="java.util.Map" >
		select count(1) from
		( select
		*
		from mt4_trades
		where 1 = 1 and  symbol != ''
		<if test="mt4Account != null">
			and login = #{mt4Account,jdbcType=INTEGER}
		</if>
		<if test="queryFrom != null">
			and close_time &gt;= #{queryFrom,jdbcType=TIMESTAMP}
		</if>
		<if test="queryTo != null">
			and close_time &lt;= #{queryTo,jdbcType=TIMESTAMP}
		</if>
		group by symbol )as t
	</select>


	<select id="pageQueryByConditionGroupBySymbol" resultMap="BaseResultMap" parameterType="java.util.Map" >
		select
		TICKET, LOGIN,  SYMBOL, DIGITS, CMD, SUM(VOLUME) as VOLUME, OPEN_TIME, OPEN_PRICE, SL, TP, CLOSE_TIME,
		EXPIRATION, REASON, CONV_RATE1, CONV_RATE2, COMMISSION, COMMISSION_AGENT, SWAPS,
		CLOSE_PRICE, PROFIT, TAXES, COMMENT, INTERNAL_ID, MARGIN_RATE, TIMESTAMP, GW_VOLUME,
		GW_OPEN_PRICE, GW_CLOSE_PRICE, MODIFY_TIME
		from mt4_trades  where 1=1 and  symbol != ''
		<if test="mt4Account != null">
			and login = #{mt4Account,jdbcType=INTEGER}
		</if>
		<if test="queryFrom != null">
			and close_time &gt;= #{queryFrom,jdbcType=TIMESTAMP}
		</if>
		<if test="queryTo != null">
			and close_time &lt;= #{queryTo,jdbcType=TIMESTAMP}
		</if>
		group by symbol
		<if test="offset gt 0">
			and (
			(SELECT MIN(TICKET) FROM (SELECT TICKET FROM mt4_trades where 1=1 and  symbol != ''
			<if test="mt4Account != null">
				and login = #{mt4Account,jdbcType=INTEGER}
			</if>
			<if test="queryFrom != null">
				and close_time &gt;= #{queryFrom,jdbcType=TIMESTAMP}
			</if>
			<if test="queryTo != null">
				and close_time &lt;= #{queryTo,jdbcType=TIMESTAMP}
			</if>
			group by symbol
			ORDER BY TICKET desc LIMIT ${offset}) AS T) > TICKET
			)
		</if>
		order by TICKET desc LIMIT ${limit}
	</select>
	<select id="queryCountByConditionMt4AccountDetailBySymbo" resultType="java.lang.Integer" parameterType="java.util.Map" >
		select
		count(1)
		from mt4_trades
		where 1=1
		<if test="mt4Account != null">
			and login = #{mt4Account,jdbcType=INTEGER}
		</if>
		<if test="queryFrom != null">
			and close_time &gt;= #{queryFrom,jdbcType=TIMESTAMP}
		</if>
		<if test="queryTo != null">
			and close_time &lt;= #{queryTo,jdbcType=TIMESTAMP}
		</if>
		<if test="symbol != null">
			and symbol = #{symbol,jdbcType=CHAR}
		</if>
	</select>
	<select id="pageQueryByConditionMt4AccountDetailBySymbol" resultMap="BaseResultMap" parameterType="java.util.Map" >
		select
		<include refid="Base_Column_List" />
		from mt4_trades  where  1=1
		<if test="mt4Account != null">
			and login = #{mt4Account,jdbcType=INTEGER}
		</if>
		<if test="queryFrom != null">
			and close_time &gt;= #{queryFrom,jdbcType=TIMESTAMP}
		</if>
		<if test="queryTo != null">
			and close_time &lt;= #{queryTo,jdbcType=TIMESTAMP}
		</if>
		<if test="symbol != null">
			and symbol = #{symbol,jdbcType=CHAR}
		</if>
		<if test="offset gt 0">
			and (
			(SELECT MIN(TICKET) FROM (SELECT TICKET FROM mt4_trades where 1=1
			<if test="mt4Account != null">
				and login = #{mt4Account,jdbcType=INTEGER}
			</if>
			<if test="queryFrom != null">
				and close_time &gt;= #{queryFrom,jdbcType=TIMESTAMP}
			</if>
			<if test="queryTo != null">
				and close_time &lt;= #{queryTo,jdbcType=TIMESTAMP}
			</if>
			<if test="symbol != null">
				and symbol = #{symbol,jdbcType=CHAR}
			</if>
			ORDER BY TICKET desc LIMIT ${offset}) AS T) > TICKET
			)
		</if>
		order by TICKET desc LIMIT ${limit}
	</select>
	<select id="getMt4TradesByList" resultMap="BaseResultMap" parameterType="java.util.Map">
		SELECT
		<include refid="Base_Column_List"/>
		FROM mt4_trades
		where 2>cmd and login in
		<foreach item="login" index="index" collection="uidList" open="(" separator="," close=")">
			#{login}
		</foreach>
	</select>
	<select id="getAmountInByAccountTime" resultMap="ComprehensiveReportOnedayMap" parameterType="java.util.Map">
		SELECT
		sum(profit) as amountIn,login as account
		FROM mt4_trades
		where close_time >'1970-1-1' and close_time &lt; #{today,jdbcType=TIMESTAMP} and CMD=6 and profit>0 and login in
		<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
			#{login}
		</foreach>
		group by login
	</select>
	<select id="getAmountOutByAccountTime" resultMap="ComprehensiveReportOnedayMap" parameterType="java.util.Map">
		SELECT
		sum(profit) as amountOut,login as account
		FROM mt4_trades
		where close_time >'1970-1-1' and close_time &lt; #{today,jdbcType=TIMESTAMP} and CMD=6 and profit &lt;0 and login in
		<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
			#{login}
		</foreach>
		group by login
	</select>
	<select id="getCommissionAndTaxesByAccountTime" resultMap="ComprehensiveReportOnedayMap" parameterType="java.util.Map">
		SELECT
		sum(commission) as commission,sum(swaps) as taxes,login as account
		FROM mt4_trades
		where close_time >'1970-1-1' and close_time &lt; #{today,jdbcType=TIMESTAMP}  and login in
		<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
			#{login}
		</foreach>
		group by login
	</select>
	<select id="getProfitByAccountTime" resultMap="ComprehensiveReportOnedayMap" parameterType="java.util.Map">
		SELECT
		sum(profit) as profit,login as account
		FROM mt4_trades
		where close_time >'1970-1-1' and close_time &lt; #{today,jdbcType=TIMESTAMP} and CMD in (1,0)  and login in
		<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
			#{login}
		</foreach>
		group by login
	</select>
	<select id="getAmountInByAccountTimeToday" resultMap="ComprehensiveReportOnedayMap" parameterType="java.util.Map">
		SELECT
		sum(profit) as amountIn,login as account
		FROM mt4_trades
		where close_time >'1970-1-1' and close_time BETWEEN #{today,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP} and CMD=6 and profit>0 and login in
		<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
			#{login}
		</foreach>
		group by login
	</select>
	<select id="getAmountOutByAccountTimeToday" resultMap="ComprehensiveReportOnedayMap" parameterType="java.util.Map">
		SELECT
		sum(profit) as amountOut,login as account
		FROM mt4_trades
		where close_time >'1970-1-1' and close_time BETWEEN #{today,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP} and CMD=6 and profit &lt;0 and login in
		<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
			#{login}
		</foreach>
		group by login
	</select>
	<select id="getCommissionAndTaxesByAccountTimeToday" resultMap="ComprehensiveReportOnedayMap" parameterType="java.util.Map">
		SELECT
		sum(commission) as commission,sum(swaps) as taxes,login as account
		FROM mt4_trades
		where close_time >'1970-1-1' and close_time BETWEEN #{today,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP}  and login in
		<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
			#{login}
		</foreach>
		group by login
	</select>
	<select id="getProfitByAccountTimeToday" resultMap="ComprehensiveReportOnedayMap" parameterType="java.util.Map">
		SELECT
		sum(profit) as profit,login as account
		FROM mt4_trades
		where close_time >'1970-1-1' and close_time BETWEEN #{today,jdbcType=TIMESTAMP} and #{date2,jdbcType=TIMESTAMP} and CMD in (1,0)  and login in
		<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
			#{login}
		</foreach>
		group by login
	</select>
	<!--存取款调整报表-->
	<select id="queryByTimeLogin" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where cmd in (6,7)
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND open_time BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginList != null">
			and login in
			<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginList == null">
			and login in ('')
		</if>
		order BY  open_time DESC
	</select>
	<select id="queryTradeshistory" resultMap="BaseResultMap" parameterType="java.util.Map">
		SELECT
		<include refid="Base_Column_List"/>
		FROM mt4_trades
		where close_time > '1970-01-01 00:00:00' and close_time != '' and cmd &lt; 2
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND close_time BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginList != null">
			and login in
			<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginList == null">
			and login in ('')
		</if>
			${orderByName}
	</select>
	<select id="getTotalVolume" resultType="java.lang.Integer" parameterType="java.util.Map">
		SELECT
		sum(VOLUME)
		FROM mt4_trades
		where close_time > '1970-01-01 00:00:00' and close_time != '' and cmd &lt; 2
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND close_time BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginList != null">
			and login in
			<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginList == null">
			and login in ('')
		</if>
	</select>
	<select id="getTotalCommission" resultType="java.lang.Double" parameterType="java.util.Map">
		SELECT
		sum(COMMISSION)
		FROM mt4_trades
		where close_time > '1970-01-01 00:00:00' and close_time != '' and cmd &lt; 2
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND close_time BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginList != null">
			and login in
			<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginList == null">
			and login in ('')
		</if>
	</select>
	<select id="getTotalSwaps" resultType="java.lang.Double" parameterType="java.util.Map">
		SELECT
		sum(SWAPS)
		FROM mt4_trades
		where close_time > '1970-01-01 00:00:00' and close_time != '' and cmd &lt; 2
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND close_time BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginList != null">
			and login in
			<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginList == null">
			and login in ('')
		</if>
	</select>
	<select id="getTotalProfit" resultType="java.lang.Double" parameterType="java.util.Map">
		SELECT
		sum(PROFIT)
		FROM mt4_trades
		where close_time > '1970-01-01 00:00:00' and close_time != '' and cmd &lt; 2
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND close_time BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginList != null">
			and login in
			<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginList == null">
			and login in ('')
		</if>
	</select>



	<select id="getMt4TradesByAccountGroup" resultMap="BaseResultMap" parameterType="java.util.Map" >
		SELECT login,SUM(volume) as volume,SUM(swaps) as swaps,SUM(profit) as profit FROM mt4_trades WHERE cmd&lt;2
		and CLOSE_TIME between #{startDate,jdbcType=TIMESTAMP} and #{endDate,jdbcType=TIMESTAMP}
   <if test="loginList != null">
   	    and login in <foreach item="logins" index="index" collection="loginList" open="(" separator="," close=")">  #{logins}</foreach> 
   </if>
		<if test="loginList == null">
			and login in ('')
		</if>
		<if test="symbolsList != null">
			and SYMBOL in <foreach collection="symbolsList" item="symbols" separator="," open="(" close=")">#{symbols,jdbcType=VARCHAR}</foreach>
		</if>
		<if test="login!=null"> and login =#{login}</if>
		<!--<if test="login != null"> and login = #{login}</if>-->
		group by login  order by login

	</select>

	<select id="queryPositionInquiry" resultMap="BaseResultMap" parameterType="java.util.Map">
		SELECT
		<include refid="Base_Column_List"/>
		FROM mt4_trades
		where (close_time = '1970-01-01 00:00:00' or close_time = '' ) and cmd &lt; 2
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND OPEN_TIME BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginList != null">
			and login in
			<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginList == null">
			and login in ('')
		</if>
		${orderByName}
	</select>
	<select id="getPositionTotalVolume" resultType="java.lang.Integer" parameterType="java.util.Map">
		SELECT
		sum(VOLUME) volume
		FROM mt4_trades
		where (close_time = '1970-01-01 00:00:00' or close_time = '' ) and cmd &lt; 2
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND OPEN_TIME BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginList != null">
			and login in
			<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginList == null">
			and login in ('')
		</if>
	</select>
	<select id="getPositionTotalCommission" resultType="java.lang.Double" parameterType="java.util.Map">
		SELECT
		sum(COMMISSION) commission
		FROM mt4_trades
		where (close_time = '1970-01-01 00:00:00' or close_time = '' ) and cmd &lt; 2
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND OPEN_TIME BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginList != null">
			and login in
			<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginList == null">
			and login in ('')
		</if>
	</select>
	<select id="getPositionTotalSwaps" resultType="java.lang.Double" parameterType="java.util.Map">
		SELECT
		sum(SWAPS) swaps
		FROM mt4_trades
		where (close_time = '1970-01-01 00:00:00' or close_time = '' ) and cmd &lt; 2
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND OPEN_TIME BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginList != null">
			and login in
			<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginList == null">
			and login in ('')
		</if>
	</select>
	<select id="getPositionTotalProfit" resultType="java.lang.Double" parameterType="java.util.Map">
		SELECT
		sum(PROFIT) profit
		FROM mt4_trades
		where (close_time = '1970-01-01 00:00:00' or close_time = '' ) and cmd &lt; 2
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND OPEN_TIME BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginList != null">
			and login in
			<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginList == null">
			and login in ('')
		</if>
	</select>



	<select id="findMt4TradesByLoginAndCmdInList" resultMap="BaseResultMap" parameterType="java.util.Map">
		SELECT
		<include refid="Base_Column_List"/>
		FROM mt4_trades
		where (( close_time>'1970-1-1' and cmd in
		<foreach item="cmd" index="index" collection="cmdList" open="(" separator="," close=")">
			#{cmd}
		</foreach>
		<if test="mt4Account != null">
			and login = #{mt4Account,jdbcType=INTEGER}
		</if>
		) or (close_time = '1970-01-01 00:00:00' and cmd in (0,1,2,3,4,5) 
			<if test="mt4Account != null">
			and login = #{mt4Account,jdbcType=INTEGER}
		</if>
		)) AND OPEN_TIME BETWEEN #{startDate,jdbcType=TIMESTAMP} AND #{endDate,jdbcType=TIMESTAMP}
	</select>
	<select id="getDepositTotalByLogin" resultType="java.lang.Double" parameterType="java.util.Map">
		SELECT SUM(PROFIT) from mt4_trades WHERE CMD = 6 AND OPEN_TIME BETWEEN #{startDate,jdbcType=TIMESTAMP} AND #{endDate,jdbcType=TIMESTAMP} and CLOSE_TIME &gt; '1970-1-1' and login = #{mt4Account,jdbcType=INTEGER} and PROFIT &gt; 0
	</select>
	<select id="getWithdrawalTotalByLogin" resultType="java.lang.Double" parameterType="java.util.Map">
		SELECT SUM(PROFIT) from mt4_trades WHERE CMD = 6 AND OPEN_TIME BETWEEN #{startDate,jdbcType=TIMESTAMP} AND #{endDate,jdbcType=TIMESTAMP} and CLOSE_TIME &gt; '1970-1-1' and login = #{mt4Account,jdbcType=INTEGER} and PROFIT &lt; 0
	</select>
	<select id="getClosedPLTotalByLogin" resultType="java.lang.Double" parameterType="java.util.Map">
		SELECT
		SUM(PROFIT+commission+taxes+swaps)
		FROM
		mt4_trades
		WHERE
		cmd IN (0, 1)
		AND CLOSE_TIME &gt; '1970-1-1'
		AND login = #{mt4Account,jdbcType=INTEGER}
		AND OPEN_TIME BETWEEN #{startDate,jdbcType=TIMESTAMP}
		AND #{endDate,jdbcType=TIMESTAMP}
	</select>
	<select id="getFloatingPLTotalByLogin" resultType="java.lang.Double" parameterType="java.util.Map">
		SELECT
		SUM(PROFIT+commission+taxes+swaps)
		FROM
		mt4_trades
		WHERE
		cmd IN (0, 1)
		AND CLOSE_TIME = '1970-01-01 00:00:00'
		AND login = #{mt4Account,jdbcType=INTEGER}
		AND OPEN_TIME BETWEEN #{startDate,jdbcType=TIMESTAMP}
		AND #{endDate,jdbcType=TIMESTAMP}
	</select>
	<!--止损止盈报表-->
	<select id="getByTimeAccount" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where close_time='1970-1-1' and cmd &lt; 2 and (SL>0 or TP>0)
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND OPEN_TIME BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginList != null">
			and login in
			<foreach item="login" index="index" collection="loginList" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginList == null">
			and login in ('')
		</if>
		order BY  OPEN_TIME DESC
	</select>
	<!-- 判断一个账号是否有持仓-->
	<select id="countByPositions" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(1)
		from  mt4_trades
		where login = #{mt4Account,jdbcType=INTEGER}
		and (close_time = '1970-01-01 00:00:00' or close_time = '' ) and cmd &lt; 2
	</select>

	<!-- 查询关闭交易量-->
	<select id="queryVolumnList" resultMap="RPQueryVolumeMap" parameterType="java.util.Map">
		SELECT 'CLOSE' as 'type' ,DATE(close_time) as date,
		sum(if (u.group like 'M_%'and symbol like '______-%',volume,0)) as 'bbookfx',
		ROUND(sum(if (u.group like 'M_%'and symbol like '______-%',profit+swaps,0)),2) as 'bbookfxprofit',

		sum(if (u.group like 'M_%'and symbol not like '______-%',volume,0)) as 'bbookindex',
		ROUND(sum(if (u.group like 'M_%'and symbol not like '______-%',profit+swaps,0)),2) as 'bbookindexprofit',

		sum(if (u.group like 'S_%'and symbol like '______-%',volume,0)) as 'sbookfx',
		ROUND(sum(if (u.group like 'S_%'and symbol like '______-%',profit+swaps,0)),2) as 'sbookfxprofit',

		sum(if (u.group like 'S_%'and symbol not like '______-%',volume,0)) as 'sbookindex',
		ROUND(sum(if (u.group like 'S_%'and symbol not like '______-%',profit+swaps,0)),2) as 'sbookindexprofit'
		from mt4_trades t, mt4_users u
		where t.login=u.login
		<if test="startDate != null and endDate != null">
		and close_time between #{startDate,jdbcType=TIMESTAMP} AND #{endDate,jdbcType=TIMESTAMP}
		</if>
		and cmd &lt; 2
		group by DATE(close_time)
	</select>
	<!-- 查询关闭交易量合计-->
	<select id="queryVolumnSum" resultMap="RPQueryVolumeMap" parameterType="java.util.Map">
		SELECT 'CLOSE' as 'type' ,DATE(close_time) as date,
		ifnull(sum(if (u.group like 'M_%'and symbol like '______-%',volume,0)),0) as 'bbookfx',
		ROUND(ifnull(sum(if (u.group like 'M_%'and symbol like '______-%',profit+swaps,0)),0),2) as 'bbookfxprofit',

		ifnull(sum(if (u.group like 'M_%'and symbol not like '______-%',volume,0)),0) as 'bbookindex',
		ROUND(ifnull(sum(if (u.group like 'M_%'and symbol not like '______-%',profit+swaps,0)),0),2) as 'bbookindexprofit',

		ifnull(sum(if (u.group like 'S_%'and symbol like '______-%',volume,0)),0) as 'sbookfx',
		ROUND(ifnull(sum(if (u.group like 'S_%'and symbol like '______-%',profit+swaps,0)),0),2) as 'sbookfxprofit',

		ifnull(sum(if (u.group like 'S_%'and symbol not like '______-%',volume,0)),0) as 'sbookindex',
		ROUND(ifnull(sum(if (u.group like 'S_%'and symbol not like '______-%',profit+swaps,0)),0),2) as 'sbookindexprofit'
		from mt4_trades t, mt4_users u
		where t.login=u.login
		<if test="startDate != null and endDate != null">
			and close_time between #{startDate,jdbcType=TIMESTAMP} AND #{endDate,jdbcType=TIMESTAMP}
		</if>
		and cmd &lt; 2
	</select>
	<!--bbook prifot-->
	<select id="selectBbookProfit" resultMap="BbookuserMap"  parameterType="java.util.Map">
		SELECT
		t.login AS login,
		t.EQUITY AS old_equity,
		ifnull(b.deposit,0) as deposit,
		<if test="exchange!=null">
			ifnull(c.exchange,0) as exchange,
		</if>
		<if test="gold!=null">
			ifnull(c.gold,0) as gold,
		</if>
		<if test="silver!=null">
			ifnull(c.silver,0) as silver,
		</if>
		<if test="A50!=null">
			ifnull(c.A50,0) as A50,
		</if>
		<if test="oil!=null">
			ifnull(c.oil,0) as oil,
		</if>
		ifnull(b.withdraw,0) as withdraw
		FROM
		mt4_users t
		LEFT JOIN
		(
		SELECT
		login,
		sum(IF(profit &gt; 0, profit, 0)) AS deposit,
		sum(IF(profit &lt; 0, profit, 0)) AS withdraw
		FROM
		mt4_trades
		WHERE
		CMD = 6
		AND CLOSE_TIME between #{startDate,jdbcType=TIMESTAMP} AND #{endDate,jdbcType=TIMESTAMP}
		GROUP BY
		login
		) b ON T.LOGIN = B.login LEFT JOIN
		(
		SELECT
		login,
		<if test="exchange!=null">
			sum(if(SYMBOL in (#{exchange,jdbcType=VARCHAR}),VOLUME,0)) / 100 AS 'exchange',<!--外汇-->
		</if>
		<if test="gold!=null">
			sum(if(SYMBOL in (#{gold,jdbcType=VARCHAR}),VOLUME,0)) / 100 AS 'gold',<!--黄金-->
		</if>
		<if test="silver!=null">
			sum(if(SYMBOL in (#{silver,jdbcType=VARCHAR}),VOLUME,0)) / 100 AS 'silver',<!--白银-->
		</if>
		<if test="A50!=null">
			sum(if(SYMBOL in (#{A50,jdbcType=VARCHAR}),VOLUME,0)) / 100 AS 'A50',<!--A50-->
		</if>
		<if test="oil!=null">
			sum(if(SYMBOL in (#{oil,jdbcType=VARCHAR}),VOLUME,0)) / 100 AS 'oil'<!--石油-->
		</if>
		FROM
		mt4_trades
		WHERE
		CMD &lt; 2
		AND CLOSE_TIME between #{startDate,jdbcType=TIMESTAMP} AND #{endDate,jdbcType=TIMESTAMP}
		GROUP BY
		login
		) c ON T.LOGIN = c.login
		AND  t.GROUP LIKE 'M_VFX_%'
	</select>

	<select id="selectBbookEquity" resultMap="BbookuserMap"  parameterType="java.util.Map">
		SELECT
		login,
		<if test="exchange!=null">
			sum(if(SYMBOL LIKE #{exchange,jdbcType=VARCHAR},VOLUME,0)) / 100 AS 'exchange',<!--外汇-->
		</if>
		<if test="gold!=null">
			sum(if(SYMBOL LIKE #{gold,jdbcType=VARCHAR},VOLUME,0)) / 100 AS 'gold',<!--黄金-->
		</if>
		<if test="silver!=null">
			sum(if(SYMBOL LIKE #{silver,jdbcType=VARCHAR},VOLUME,0)) / 100 AS 'silver',<!--白银-->
		</if>
		<if test="A50!=null">
			sum(if(SYMBOL LIKE #{A50,jdbcType=VARCHAR},VOLUME,0)) / 100 AS 'A50',<!--A50-->
		</if>
		<if test="oil!=null">
			sum(if(SYMBOL LIKE #{oil,jdbcType=VARCHAR},VOLUME,0)) / 100 AS 'oil'<!--石油-->
		</if>
		FROM
		mt4_trades
		WHERE
		CMD &lt; 2
		AND CLOSE_TIME between #{startDate,jdbcType=TIMESTAMP} AND #{endDate,jdbcType=TIMESTAMP}
		GROUP BY
		login
	</select>
    <select id="getSumVolumeByMT4AccountAndSymbol" resultType="java.lang.Integer" parameterType="java.util.Map">
        SELECT sum(VOLUME) FROM mt4_trades WHERE login IN
        <foreach item="mt4_account" index="index" collection="mt4accountlist" open="(" separator="," close=")">
            #{mt4_account}
        </foreach>
        AND symbol IN
        <foreach item="symbol" index="index" collection="tradingGroupSymbolsList" open="(" separator="," close=")">
            #{symbol}
        </foreach>
        AND close_time BETWEEN #{date1, jdbcType=TIMESTAMP} AND #{date2, jdbcType=TIMESTAMP}
        AND cmd &lt; 2
    </select>
    <select id="getVolumeByMT4Accounts" resultType="java.lang.Integer" parameterType="java.util.Map">
        SELECT sum(VOLUME) FROM mt4_trades WHERE login IN
        <foreach item="mt4_account" index="index" collection="mt4accountlist" open="(" separator="," close=")">
            #{mt4_account}
        </foreach>
        AND close_time BETWEEN #{date1, jdbcType=TIMESTAMP} AND #{date2, jdbcType=TIMESTAMP}
        AND cmd &lt; 2
    </select>
	<select id="queryByDateAndLogin" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where cmd in (6,7)
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND open_time BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
			and login =	#{mt4Account}
		order BY  open_time DESC
	</select>

	<select id="queryByDateLogin" resultMap="BaseResultMap" parameterType="java.util.Map">
		select
		<include refid="Base_Column_List" />
		from mt4_trades
		where cmd = 7
		<if test="date1!='' and date1!=null and date2!='' and date2!=null ">
			AND open_time BETWEEN #{date1,jdbcType=TIMESTAMP} AND #{date2,jdbcType=TIMESTAMP}
		</if>
		<if test="loginMt4accounts != null">
			and login in
			<foreach item="login" index="index" collection="loginMt4accounts" open="(" separator="," close=")">
				#{login}
			</foreach>
		</if>
		<if test="loginMt4accounts == null">
		and login in ('')
		</if>
		order BY  open_time DESC
	</select>

</mapper>